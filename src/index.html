<html>
  <head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-25975548-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-25975548-1');
  </script>
  </head>
  <body>
  <div class='play-overlay flex'>
    <div class='play-overlay__text flex-center'>
      <span>â–·</span>
      <br />
      <small>click to play</small>
    </div>
  </div>
  <div id='app'>
    <div class='flex'>
      <div class='play-overlay__text flex-center text-center hero-text'></div>
    <div>
  </div>
  <script>
    var NAME = decodeURIComponent(location.pathname.replace(/^\//,''));

    var soundboardMediaUrl = "./";

    var startAudio = new Audio(soundboardMediaUrl+"sounds/start.mp3");
    var endAudio = new Audio(soundboardMediaUrl+"sounds/end.mp3");

    var soundboard = {};

    soundboard.speak = function(text, callback) {
      var msg = new SpeechSynthesisUtterance(text);
      var voices = speechSynthesis.getVoices();
      msg.voice = voices[0];
      msg.voiceURI = 'native';
      msg.volume = 1;
      msg.rate = 0.75;
      msg.pitch = 1;
      msg.text = text;
      msg.lang = 'en-US';
      msg.onend = callback;

      speechSynthesis.speak(msg);

      return msg;
    }

    soundboard.displayAndHisNameIs = function(name) {
      var text = "";

      var heroText = document.querySelector('.hero-text');

      var update = function() {
        heroText.innerHTML = text;
      };

      var frames = [
        [0 , "and"],
        [150, "his"],
        [150, "name"],
        [200, "is"],
      ];

      var tt = 0;

      frames.forEach(function(frame) {
        tt += frame[0];
        setTimeout(function() {
          text += " " + frame[1];
          update();
        }, tt);
      });
    };

    soundboard.displayClear = function() {
      var heroText = document.querySelector('.hero-text');
      heroText.innerHTML = "";
    };

    soundboard.displayAppendText = function(text) {
      var heroText = document.querySelector('.hero-text');
      heroText.innerHTML += text;
    };

    soundboard.displayNameShake = function(name) {
      var heroText = document.querySelector('body');
      heroText.className = heroText.className.replace("boom-animation","");
      heroText.className += " boom-animation";
    };

    soundboard.andHisNameIs = function(name) {

      startAudio.load();
      endAudio.load();

      try {
        startAudio
          .play()
          .then(function() {
            clickOverlay.remove();
            soundboard.displayAndHisNameIs(name);
            startAudio.addEventListener("ended", function() {
              soundboard.displayClear();
              utterence = soundboard.speak(name, function() {
                soundboard.displayClear();
                soundboard.displayAppendText(name);
                soundboard.displayNameShake();
                endAudio.play();
              });

              var nameParts = name.split(" ");

              utterence.onboundary = function(event) {
                if(event.name === "word") {
                  var part = nameParts.shift();
                  if(!part) {
                    return
                  }
                  part += " ";
                  soundboard.displayAppendText(part);
                }
              };
            }, false);
          })
          .catch(function(e) {
            console.error(e);
            throw e;
          });
      } catch(e) {
        console.error(e);
        throw e;
      }
    }

    var clickOverlay = document.querySelector('.play-overlay');

    clickOverlay.addEventListener('click', function() {
      soundboard.andHisNameIs(NAME);
    }, false);

  clickOverlay.addEventListener('mouseover', function() {
    console.log(123);
      soundboard.andHisNameIs(NAME);
    }, false);



    var start = function() {
      try {
        soundboard.andHisNameIs(NAME);
      } catch(e) {
        console.log(e);
      }
    };

    start();
  </script>
  </body>
</html>
